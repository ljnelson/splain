<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2013-09-12
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130912" />
    <meta http-equiv="Content-Language" content="en" />
    <title>splain - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300"/>
          
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/ljnelson/splain">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>splain</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2013-09-12</li>
                      
                
                    
                 <li id="projectVersion" class="pull-right">Version: 2.0.0-SNAPSHOT</li>
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Usage Documentation</li>
                                
      <li>
    
                          <a href="index.html" title="Overview">
          <i class="none"></i>
        Overview</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Usage</a>
          </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                            
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                      
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- -*- markdown -*- --><h1>Usage</h1>
<p>Here&#x2019;s how to use <tt>splain</tt> in your project in the most common scenario, <i>viz.</i> producing intelligent error messages given a chain of <tt>Throwable</tt>s.</p>
<div class="section">
<h2>Add splain to Your Classpath<a name="Add_splain_to_Your_Classpath"></a></h2>
<p>To use the <tt>splain</tt> project, please see the <a href="dependency-info.html">Dependency Information</a> report for full details.</p>
<p>In brief, the following dependency in a Maven project will work:</p>

<div class="source">
<pre>&lt;dependency&gt;
  &lt;groupId&gt;com.edugility&lt;/groupId&gt;
  &lt;artifactId&gt;splain&lt;/artifactId&gt;
  &lt;version&gt;2.0.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
</pre></div></div>
<div class="section">
<h2>Decide Where Your Message Catalog Will Live<a name="Decide_Where_Your_Message_Catalog_Will_Live"></a></h2>
<p><tt>splain</tt> relies on a <i>message catalog</i>&#x2014;a text file containing entries consisting of <tt>objexj</tt> patterns and the messages they select. The format of such a file is detailed in the <a href="apidocs/com/edugility/splain/io/MessageFactoryReader.html#read">documentation for the <tt>MessageFactoryReader#read()</tt> method</a>.</p>
<p>You may place a message catalog anywhere on your application&#x2019;s classpath. (Actually, you may place it anywhere you wish, as long as you can figure out how to get a <tt>java.io.Reader</tt> that will read it.)</p>
<p>You should also give thought to the tier that your message catalog will belong to. Will this message catalog be for diagnosing problems at the middleware layer? Or for selecting a message for display on a particular user interface? Answering these questions will help you figure out where to place your message catalog, and how many message catalogs you will have in your application. In terms of bang for the buck, <tt>splain</tt> is probably best for coming up with messages to display for particular UIs.</p></div>
<div class="section">
<h2>Decide Where splain Will Actually Run<a name="Decide_Where_splain_Will_Actually_Run"></a></h2>
<p>This is closely related to the prior point. Will <tt>splain</tt> run in a Servlet filter? Will it run in an interceptor of some kind?</p></div>
<div class="section">
<h2>Assemble a Message Catalog<a name="Assemble_a_Message_Catalog"></a></h2>
<p>Begin your message catalog by working backwards. </p>

<div class="section">
<h3>Ensure There Is A Catch-All<a name="Ensure_There_Is_A_Catch-All"></a></h3>
<p>Insert an entry that will (if it is ever reached) match all possible errors. Here is a sample entry in a message catalog that I&#x2019;ve decided arbitrarily to name <tt>Messages.mc</tt>, and to locate in my classpath somewhere:</p>

<div class="source">
<pre>^(java.lang.Throwable)
--
${$1[0].toString()}
</pre></div>
<p>The first line is an <tt>objexj</tt> pattern. It matches any <tt>List</tt> whose first item (&#x201c;<tt>^</tt>&#x201d;) is a <tt>Throwable</tt>. Additionally, as you can see from the parentheses, it saves a reference to the <tt>Throwable</tt> so matched.</p>
<p>The second line is a separator (two hyphens) that divides the pattern section of this entry from the message.</p>
<p>The third line is the message itself. In this case, it&#x2019;s not much of a localized message. It is instead a way using MVEL templates to get the matched <tt>Throwable</tt> to print its stack trace.</p>
<p>The first <tt>${</tt> is the indication that an MVEL expression follows. The <tt>$1</tt> variable refers to the first capture group match (the sublist of <tt>Throwable</tt>s we matched in our pattern&#x2014;in this case this <tt>List</tt> has a size of exactly <tt>1</tt>. The index selector, <tt>[0]</tt> selects the first (and only!) item from that sublist, namely the <tt>Throwable</tt> we&#x2019;re interested in. Finally, the <tt>.toString()</tt> is just a method call on that <tt>Throwable</tt>, and that will become the final value of the MVEL expression.</p>
<p>You can see how this entry will match any <tt>List</tt> of <tt>Throwable</tt>s handed to it and will produce a suitable message. The message, however, is not very interesting.</p>
</div>
<div class="section">
<h3>Set Up A ResourceBundle<a name="Set_Up_A_ResourceBundle"></a></h3>
<p>The whole point of <tt>splain</tt> is to provide more intelligent and localized error messages. So let&#x2019;s make sure we have a <tt>ResourceBundle</tt> set up with a couple of error messages. We&#x2019;ll set them up here, and explain them a little later.</p>
<p>Let&#x2019;s create a file called <tt>DatabaseErrorMessages.properties</tt> in Java properties format and save it somewhere in the classpath. We&#x2019;ll give it a single property setting like this:</p>

<div class="source">
<pre>ipSocketError = An IP socket could not be opened.  This corresponds to a SQL state of ${ss}.
</pre></div>
</div>
<div class="section">
<h3>Add Other Message Catalog Entries Above The Catch-All<a name="Add_Other_Message_Catalog_Entries_Above_The_Catch-All"></a></h3>
<p>Now that we have a safety valve that will handle all errors, let&#x2019;s add a more interesting message.</p>
<p>Suppose we&#x2019;re writing a database application. <tt>SQLException</tt>s are therefore things we are likely to encounter fairly frequently.</p>
<p><tt>SQLException</tt>s have an <tt>errorCode</tt> property, a <tt>sqlState</tt> property and inherit the usual <tt>message</tt> property as well. Let&#x2019;s further assume that we&#x2019;re working with the <a class="externalLink" href="http://www.mysql.com/">MySQL</a> database, just because they happen to have a nice <a class="externalLink" href="http://dev.mysql.com/doc/refman/5.7/en/error-messages-server.html">list of error codes</a> that is easy to refer to.</p>
<p>We&#x2019;ll put a message catalog entry in that provides a localized and informative message for a particular kind of <tt>SQLException</tt> that we encounter.</p>
<p>Here&#x2019;s the entry:</p>

<div class="source">
<pre>java.sql.SQLException(ss = this.sqlState; errorCode == 1081)$
--
DatabaseErrorMessages/ipSocketError
</pre></div>
<p>Here, we have an <tt>objexj</tt> pattern that matches when the <i>last</i> item in the input list is a <tt>SQLException</tt> whose <tt>errorCode</tt> property equals <tt>1081</tt>. Should this pattern match, we instruct <tt>splain</tt> to attempt to locate a resource named <tt>ipSocketError</tt> in a <tt>ResourceBundle</tt> named <tt>DatabaseErrorMessages</tt> accessible on the classpath.</p>
<p>We place this entry above the &#x201c;catch-all&#x201d; entry, so that it will not be shadowed by the catch-all entry.</p></div></div>
<div class="section">
<h2>Incorporate splain Into Your Code<a name="Incorporate_splain_Into_Your_Code"></a></h2>
<p>Suppose in our web tier we run some business logic and catch <tt>Exception</tt>, like this:</p>

<div class="source">
<pre>// splain initialization needs to happen before this block

try {
  frobnicator.frobnicate();
} catch (final Exception exception) {
  // splain execution will go here
}
</pre></div>
<p>Suppose further that for various reasons we want the client-appropriate message to be produced here (there are other choices, ranging from error message production in Javascript on the browser to no message at all).</p>
<p>Finally, suppose that for the purposes of this discussion you and I know that the exception we&#x2019;re getting has a <tt>SQLException</tt> at the bottom of it with a vendor error code of <tt>1081</tt>. Obviously our code here does not know that.</p>
<p>Here&#x2019;s how it would look, put all together (I&#x2019;ve also used the (convenient) <a class="externalLink" href="http://ljnelson.github.io/edugility-throwables/apidocs/com/edugility/throwables/ThrowableList.html"><tt>ThrowableList</tt> class</a> to produce a <tt>List</tt> implementation out of a <tt>Throwable</tt> and its chain of causes; you may do this however you wish):</p>

<div class="source">
<pre>// somewhere in an init() method somewhere:
MessageFactoryReader mfr = null;
final MessageFactory mf;
MessageFactory tempMf = null;
try {
  mfr = new MessageFactoryReader(&quot;Messages.mc&quot;);
  tempMf = mfr.read();
} catch (final IOException handleMe) {
  // handle appropriately
} catch (final ParseException handleMeToo) {
  // handle appropriately
} finally {
  mf = tempMf;
  if (mfr != null) {
    try {
      mfr.close();
    } catch (final IOException ohWell) {
      // log appropriately
    }
  }
}
assert mf != null;

try {
  frobnicator.frobnicate();
} catch (final Exception exception) {
  final Locale locale = httpRequest.getLocale();
  final Object message = mf.getMessage(new ThrowableList(exception), locale);
  assert message != null;
  // serve message up to the client
}
</pre></div>
<p>In this code snippet, <tt>message</tt> would be the following <tt>String</tt>:</p>

<blockquote>
<p>An IP socket could not be opened. This corresponds to a SQL state of 08S01.</p>
</blockquote>
<p>You&#x2019;ll notice that <tt>${ss}</tt> has been substituted with the <tt>SQLException</tt>&#x2019;s <tt>sqlState</tt> property value.</p>
<p>You&#x2019;ll also notice that the message itself came from the appropriate resource bundle, and that it is appropriate to the exception chain we received. That&#x2019;s what <tt>splain</tt> is all about.</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2013
                        <a href="http://about.me/lairdnelson">Laird Nelson</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
